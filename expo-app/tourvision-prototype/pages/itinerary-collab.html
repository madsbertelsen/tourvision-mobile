<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Adventure - Shared with you - TourVision</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900" x-data="collaboratorView()" x-init="init()" :class="{ 'dark': darkMode }">
    
    <!-- Collaboration Banner -->
    <div class="bg-blue-600 text-white px-4 py-2">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.032 4.026a9.001 9.001 0 01-7.432 0"></path>
                </svg>
                <span class="text-sm">Shared by <strong>John Doe</strong> • You can comment and suggest changes</span>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex -space-x-2">
                    <div class="w-7 h-7 bg-white rounded-full border-2 border-blue-600 flex items-center justify-center" title="John Doe (Owner)">
                        <span class="text-xs font-bold text-blue-600">JD</span>
                    </div>
                    <div class="w-7 h-7 bg-purple-500 rounded-full border-2 border-blue-600 flex items-center justify-center" title="Sarah Chen">
                        <span class="text-xs font-bold text-white">SC</span>
                    </div>
                    <div class="w-7 h-7 bg-green-500 rounded-full border-2 border-blue-600 flex items-center justify-center" title="You">
                        <span class="text-xs font-bold text-white">ME</span>
                    </div>
                </div>
                <span class="text-sm">3 collaborators</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="../index.html" class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-lg">T</span>
                        </div>
                        <span class="font-bold text-xl text-gray-900 dark:text-white">TourVision</span>
                    </a>
                    <span class="text-gray-400">/</span>
                    <h1 class="text-xl font-semibold text-gray-900 dark:text-white">Paris Adventure - 5 Days</h1>
                    <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs rounded-full">View only</span>
                </div>
                <button @click="showTutorial = true" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    How to Comment
                </button>
            </div>
        </div>
    </header>

    <div class="flex h-[calc(100vh-120px)]">
        <!-- Main Content Area -->
        <div class="flex-1 flex">
            <!-- Text Editor (Read-only with comment ability) -->
            <div class="flex-1 bg-white dark:bg-gray-800 overflow-y-auto relative">
                <div class="prose dark:prose-invert max-w-none p-6" @mouseup="handleTextSelection($event)">
                    <h1>Paris Adventure Itinerary</h1>
                    <p class="lead">5 days exploring the City of Light - September 15-19, 2024</p>
                    
                    <h2>Day 1: Iconic Landmarks</h2>
                    <h3>Morning (9:00 AM - 12:00 PM)</h3>
                    <ul>
                        <li>
                            <strong class="text-blue-600">Eiffel Tower</strong> - Start your day at Paris's most famous landmark. Book skip-the-line tickets in advance.
                            <span class="inline-flex items-center ml-2">
                                <span class="w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center cursor-pointer hover:bg-yellow-500" @click="showExistingComment(1)">
                                    <span class="text-xs font-bold text-gray-800">2</span>
                                </span>
                            </span>
                        </li>
                        <li>Duration: 2-3 hours including elevator ride to summit</li>
                        <li>Cost: €26.80 for summit access</li>
                    </ul>
                    
                    <h3>Afternoon (1:00 PM - 5:00 PM)</h3>
                    <ul>
                        <li>
                            <strong class="text-purple-600">Louvre Museum</strong> - World's largest art museum
                            <span class="bg-yellow-200 dark:bg-yellow-900/30 px-1 rounded">
                                <span class="text-xs text-gray-600 dark:text-gray-400">[Sarah: "3 hours might be too short"]</span>
                            </span>
                        </li>
                        <li>Must-see: Mona Lisa, Venus de Milo, Winged Victory</li>
                        <li>Duration: 3-4 hours for highlights</li>
                        <li>Cost: €17 (book online to skip lines)</li>
                    </ul>
                    
                    <h3>Evening (6:00 PM - 9:00 PM)</h3>
                    <ul>
                        <li><strong class="text-green-600">Seine River Cruise</strong> - Sunset dinner cruise</li>
                        <li>Departure from Port de la Bourdonnais</li>
                        <li>Duration: 2.5 hours</li>
                        <li>Cost: €70-100 per person</li>
                    </ul>
                </div>

                <!-- Floating Comment Button (appears on text selection) -->
                <div x-show="showCommentButton" x-transition :style="`top: ${commentButtonPosition.top}px; left: ${commentButtonPosition.left}px`" class="absolute z-20">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-1">
                        <button @click="startComment()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition flex items-center">
                            <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path>
                            </svg>
                            <span class="ml-1 text-sm text-gray-700 dark:text-gray-300">Comment</span>
                        </button>
                        <button @click="startSuggestion()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition flex items-center">
                            <svg class="w-4 h-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            <span class="ml-1 text-sm text-gray-700 dark:text-gray-300">Suggest edit</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Comments Sidebar (Always visible for collaborators) -->
            <div class="w-96 border-l border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 overflow-y-auto">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-900 dark:text-white">Comments & Suggestions</h3>
                        <span class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full">5 active</span>
                    </div>

                    <!-- New Comment Input (shown when user selects text) -->
                    <div x-show="isCommenting" x-transition class="mb-4 bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-blue-500">
                        <div class="mb-3">
                            <span class="text-xs text-gray-500 dark:text-gray-400">Commenting on:</span>
                            <p class="text-sm bg-gray-100 dark:bg-gray-700 rounded p-2 mt-1 italic" x-text="selectedText"></p>
                        </div>
                        <div class="space-y-3">
                            <div x-show="commentType === 'suggestion'">
                                <label class="text-xs text-gray-600 dark:text-gray-400">Suggest a change:</label>
                                <textarea x-model="suggestionText" placeholder="Type your suggested edit..." class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                            </div>
                            <textarea x-model="commentText" :placeholder="commentType === 'suggestion' ? 'Explain your suggestion...' : 'Add your comment...'" class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-blue-500" rows="3" autofocus></textarea>
                            <div class="flex gap-2">
                                <button @click="submitComment()" class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition">
                                    Post Comment
                                </button>
                                <button @click="cancelComment()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Existing Comments -->
                    <div class="space-y-3">
                        <!-- Comment 1 -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-xs font-bold">SC</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-900 dark:text-white text-sm">Sarah Chen</span>
                                        <span class="text-xs text-gray-500">10 min ago</span>
                                    </div>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-1">Should we book the Eiffel Tower tickets now? They might sell out for our dates.</p>
                                    <div class="mt-2 flex items-center gap-3">
                                        <button class="text-xs text-blue-600 hover:underline">Reply</button>
                                        <button class="text-xs text-gray-500 hover:text-gray-700">Resolve</button>
                                    </div>
                                    <!-- Reply -->
                                    <div class="mt-3 ml-6 p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                        <div class="flex items-start space-x-2">
                                            <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                                                <span class="text-white text-xs">JD</span>
                                            </div>
                                            <div class="flex-1">
                                                <span class="text-xs font-medium">John Doe</span>
                                                <p class="text-xs text-gray-600 dark:text-gray-400">Good idea! I'll book them today.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Comment 2 with Suggestion -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 border-l-4 border-orange-500">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-xs font-bold">MJ</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-900 dark:text-white text-sm">Mike Johnson</span>
                                        <span class="text-xs text-gray-500">1 hour ago</span>
                                    </div>
                                    <div class="mt-2 p-2 bg-orange-50 dark:bg-orange-900/20 rounded border border-orange-200 dark:border-orange-800">
                                        <div class="flex items-center gap-1 mb-1">
                                            <svg class="w-3 h-3 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <span class="text-xs font-semibold text-orange-700 dark:text-orange-400">Suggested Edit</span>
                                        </div>
                                        <p class="text-xs text-orange-700 dark:text-orange-300">Change "3-4 hours" to "4-5 hours"</p>
                                    </div>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-2">The Louvre is huge! We should allocate more time to see the main exhibits properly.</p>
                                    <div class="mt-3 flex gap-2">
                                        <span class="text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 px-2 py-1 rounded">Pending owner review</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Your new comment (appears after submission) -->
                        <div x-show="newCommentAdded" x-transition class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-xs font-bold">ME</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-900 dark:text-white text-sm">You</span>
                                        <span class="text-xs text-gray-500">Just now</span>
                                    </div>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mt-1" x-text="yourComment"></p>
                                    <div class="mt-2">
                                        <span class="text-xs text-green-600 dark:text-green-400">✓ Comment posted successfully</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div x-show="showTutorial" x-transition class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6 m-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">How to Add Comments</h3>
            <div class="space-y-3 text-sm text-gray-600 dark:text-gray-400">
                <div class="flex items-start">
                    <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">1</span>
                    <p>Select any text in the itinerary that you want to comment on</p>
                </div>
                <div class="flex items-start">
                    <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">2</span>
                    <p>Click "Comment" to add feedback or "Suggest edit" to propose changes</p>
                </div>
                <div class="flex items-start">
                    <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">3</span>
                    <p>Type your comment and click "Post Comment"</p>
                </div>
                <div class="flex items-start">
                    <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-full w-6 h-6 flex items-center justify-center flex-shrink-0 mr-3">4</span>
                    <p>The owner will be notified and can accept your suggestions</p>
                </div>
            </div>
            <button @click="showTutorial = false" class="mt-6 w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                Got it!
            </button>
        </div>
    </div>

    <script>
        function collaboratorView() {
            return {
                darkMode: false,
                showCommentButton: false,
                commentButtonPosition: { top: 0, left: 0 },
                selectedText: '',
                isCommenting: false,
                commentType: 'comment',
                commentText: '',
                suggestionText: '',
                newCommentAdded: false,
                yourComment: '',
                showTutorial: false,
                
                init() {
                    this.darkMode = localStorage.getItem('darkMode') === 'true';
                    // Show tutorial on first visit
                    if (!localStorage.getItem('collaboratorTutorialSeen')) {
                        setTimeout(() => {
                            this.showTutorial = true;
                            localStorage.setItem('collaboratorTutorialSeen', 'true');
                        }, 1000);
                    }
                },
                
                handleTextSelection(event) {
                    const selection = window.getSelection();
                    const text = selection.toString().trim();
                    
                    if (text && text.length > 3) {
                        this.selectedText = text;
                        const range = selection.getRangeAt(0);
                        const rect = range.getBoundingClientRect();
                        const container = event.currentTarget.getBoundingClientRect();
                        
                        this.commentButtonPosition = {
                            top: rect.bottom - container.top + window.scrollY + 5,
                            left: rect.left - container.left + rect.width / 2 - 100
                        };
                        this.showCommentButton = true;
                    } else {
                        this.showCommentButton = false;
                    }
                },
                
                startComment() {
                    this.commentType = 'comment';
                    this.isCommenting = true;
                    this.showCommentButton = false;
                    this.commentText = '';
                    this.suggestionText = '';
                },
                
                startSuggestion() {
                    this.commentType = 'suggestion';
                    this.isCommenting = true;
                    this.showCommentButton = false;
                    this.commentText = '';
                    this.suggestionText = '';
                },
                
                submitComment() {
                    if (this.commentText.trim()) {
                        this.yourComment = this.commentText;
                        if (this.commentType === 'suggestion' && this.suggestionText) {
                            this.yourComment = `Suggestion: "${this.suggestionText}" - ${this.commentText}`;
                        }
                        
                        this.newCommentAdded = true;
                        this.isCommenting = false;
                        this.commentText = '';
                        this.suggestionText = '';
                        
                        // Show success message
                        setTimeout(() => {
                            alert('Your comment has been posted! The owner will be notified.');
                        }, 500);
                        
                        // Clear selection
                        window.getSelection().removeAllRanges();
                    }
                },
                
                cancelComment() {
                    this.isCommenting = false;
                    this.commentText = '';
                    this.suggestionText = '';
                    window.getSelection().removeAllRanges();
                },
                
                showExistingComment(id) {
                    // Scroll to and highlight the comment in sidebar
                    alert('Showing comment thread #' + id);
                }
            }
        }
    </script>

</body>
</html>